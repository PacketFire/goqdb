{{set . "title" "QDB"}}
{{template "header.html" .}}

<nav role="navigation">

	<ul>
		<li>
			<header>
				<a href="/">
					<h1>
					QDB
					</h1>
				</a>
			</header>
		</li>
		<li>
			<form role="search" class="form-inline" method="get">
				<input name="order" type="hidden" value="relevance" />
				<input name="asc" type="hidden" value="true" />
			{{with $s := .page.Size}}
				<input name="size" type="hidden" value="{{$s}}" />
			{{end}}
				<div class="form-group">
					<label class="sr-only" for="search">Search</label>
					<input name="search" id="search" type="text" class="form-control" placeholder="search" />
				</div>
				<button type="submit" class="btn btn-primary"><span class="glyphicon glyphicon-search"></span></button>
			</form>
		</li>
		<li>
			<a href="{{with $p := .page.OrderByDate}}{{url "App.Index" $p}}{{end}}" 
			class="{{if eq .page.Order "date"}}currentSort{{end}}
			{{if eq .page.Order ""}}currentSort{{end}}"
			>Date</a>
		</li>
		<li>
			<a href="{{with $p := .page.OrderByRating}}{{url "App.Index" $p}}{{end}}"
			class="{{if eq .page.Order "rating"}}currentSort{{end}}"
			>Rating</a>
		</li>
		<li>
			<a href="{{with $p := .page.OrderByRelevance}}{{url "App.Index" $p}}{{end}}"
			class="{{if eq .page.Order "relevance"}}currentSort{{end}}"
			>Relevance</a>
		</li>
		<li>
			<a href="{{if eq .page.Asc false}}{{url "App.Index" .page.SortAsc}}{{else}}{{url "App.Index" .page.SortDesc}}{{end}}">
				<span class="glyphicon glyphicon-sort"></span>
			</a>
		</li>
		<li>
			<a href="{{url "App.Index" .page.PrevPage}}" class="{{if eq .page.HasPrev false}}disabled {{end}}btn btn-primary">prev</a>
		</li>
		<li>
			<a href="{{url "App.Index" .page.NextPage}}" class="{{if eq .page.HasNext false}}disabled {{end}}btn btn-primary">next</a>
		</li>
	</ul>
</nav>


<div id="main">
	<form role="form" method="post" action="/">
		{{with $field := field "quote.Quote" .}}
		<div class="form-group {{$field.ErrorClass}}">
			<textarea class="form-control" id="quote" name="{{$field.Name}}" placeholder="quote">{{$field.Flash}}</textarea>
		</div>
		{{end}}

		<div class="row">
			{{with $field := field "quote.Tags" .}}
			<div class="form-group {{$field.ErrorClass}} col-lg-4">
				<input class="form-control" id="tags" name="{{$field.Name}}" type="text" placeholder="tags" value="{{$field.Flash}}" />
			</div>
			{{end}}
			
			{{$savedAuthor := .savedAuthor}}
			{{with $field := field "quote.Author" .}}
			<div class="form-group {{$field.ErrorClass}} col-lg-2">
				<input class="form-control" id="author" name="{{$field.Name}}" type="text" placeholder="author" value="{{$savedAuthor}}" />
			</div>
			{{end}}

			<div class="form-group">
				<button id="submit" name="submit" type="submit" class="btn btn-primary">submit</button>
			</div>
		</div>
	</form>

	<div class="well">
	{{range $t := .tagcloud}}
		<a href="?tag={{$t}}">{{$t}}</a>
	{{end}}
	</div>

	{{$page := .page}}
	
	<div class="clearfix quoteList">
	{{range $e := .entries}}
		<article id="q{{$e.QuoteId}}">
			<header class="container">
				<div class="col-xs-8">
					<p class="text-info">{{$e.Author}} &mdash; {{$e.Time}}</p>
				</div>

				<div class="col-xs-4 text-right">
					<a class="btn btn-danger btn-xs btn-vote" role="button" 
						href="{{url "App.DownVote" $e.QuoteId $page}}#q{{$e.QuoteId}}"
					>-</a>
					<span>{{$e.Rating}}</span>
					<a class="btn btn-success btn-xs btn-vote" role="button" 
						href="{{url "App.UpVote" $e.QuoteId $page}}#q{{$e.QuoteId}}"
					>+</a>
				</div>
			</header>
			<!-- TODO: could use a `well' class instead -->
			<a class="quote" href="/q/{{$e.QuoteId}}">
				<pre class="">{{$e.Clip}}</pre>
			</a>
			<p class="text-info">
			{{range $t := $e.Tags}}
				<a href="?tag={{$t}}">{{$t}}</a>
			{{end}}
			</p>
		</article>
	{{else}}
		<p class="text-info">No more results</p>
	{{end}}
	</div>
</div>


{{template "footer.html" .}}
