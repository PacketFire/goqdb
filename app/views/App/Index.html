{{set . "title" "QDB"}}
{{template "header.html" .}}

<div id="main">
	<header>
		<a href="/"><h1 class="h3">QDB</h1></a>
	</header>
	
	<br/>

	<form role="form" method="post" action="/">
		<!-- Textarea -->
		{{with $field := field "entry.Quote" .}}
		<div class="form-group">
			<textarea class="form-control {{$field.ErrorClass}}" id="quote" name="entry.Quote" placeholder="quote">{{$field.Flash}}</textarea>
		</div>
		{{end}}
		<!-- Text input-->
		<!-- XXX: use field? -->
		{{$savedAuthor := .savedAuthor}}
		{{with $field := field "entry.Author" .}}
		<div class="form-group row">
			<div class="col-xs-3">
				<input class="form-control {{$field.ErrorClass}}" id="author" name="entry.Author" type="text" placeholder="author" value="{{$savedAuthor}}">
			</div>
		</div>
		{{end}}

		<!-- Submit -->
		<div class="form-group">
			<button id="submit" name="submit" type="submit" class="btn btn-primary">submit</button>
		</div>
	</form>

	<form class="form-inline" role="form" method="get" action="">
		<div class="form-group">
			<input class="form-control" type="search" id="search" name="page.Search" value="{{.page.Search}}" placeholder="search" />
		</div>
		<button class="btn btn-primary" type=""><span class="glyphicon glyphicon-search"></span></button>
	</form>

	<br/>

	<div id="pageLinks" class="clearfix">
		<a class="btn btn-default fLeft" {{if eq .hasPrevPage false}}disabled="disabled"{{end}} 
			href="?page.Page={{.prevPage}}
				{{if .page.Search}}&page.Search={{.page.Search}}{{end}}
				{{if .page.Size}}&page.Size={{.page.Size}}{{end}}"
		>
			prev
		</a>
		<a class="btn btn-default fRight" {{if eq .hasNextPage false}}disabled="disabled"{{end}} 
			href="?page.Page={{.nextPage}}
				{{if .page.Search}}&page.Search={{.page.Search}}{{end}}
				{{if .page.Size}}&page.Size={{.page.Size}}{{end}}"
		>
			next
		</a>
	</div>
	
	<br/>
	
	{{$page := .page}}

	{{with $entries := .entries}}
	{{range $e := $entries}}
	<!-- author, time, rating buttons -->
	<a id="q{{$e.QuoteId}}"></a>
	<div class="clearfix">
		<div class="fLeft">{{$e.Author}} {{$e.Time}}</div>
		<div class="fRight">
			<a class="btn btn-danger btn-xs btn-vote" role="button" href="/down?id={{$e.QuoteId}}
				{{if $page.Search}}&page.Search={{$page.Search}}{{end}}
				{{if $page.Page}}&page.Page={{$page.Page}}{{end}}
				{{if $page.Size}}&page.Size={{$page.Size}}{{end}}
				#q{{$e.QuoteId}}	
			">-</a>
			<span>{{$e.Rating}}</span>
			<a class="btn btn-success btn-xs btn-vote" role="button" href="/up?id={{$e.QuoteId}}
				{{if $page.Search}}page.Search={{$page.Search}}{{end}}
				{{if $page.Page}}&page.Page={{$page.Page}}{{end}}
				{{if $page.Size}}&page.Size={{$page.Size}}{{end}}
				#q{{$e.QuoteId}}	
			">+</a>
		</div>
	</div>

	<!-- The actual quote -->
	<pre class="quote_entry"><a href="/q/{{$e.QuoteId}}">{{$e.Clip}}</a></pre>

	{{end}}
	{{else}}
	<p>No more results</p>
	{{end}}
</div>


{{template "footer.html" .}}
