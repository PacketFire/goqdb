{{set . "title" "QDB"}}
{{template "header.html" .}}

<div id="main">
	<header>
		<a href="/"><h1 class="h3">QDB</h1></a>
	</header>
	
	<br/>

	<form role="form" method="post" action="/">
		<!-- update form input names -->
		{{with $field := field "quote.Quote" .}}
		<div class="form-group {{$field.ErrorClass}}">
			<textarea class="form-control" id="quote" name="{{$field.Name}}" placeholder="quote">{{$field.Flash}}</textarea>
		</div>
		{{end}}

		<div class="row">
			{{with $field := field "quote.Tags" .}}
			<div class="form-group {{$field.ErrorClass}} col-xs-5">
				<input class="form-control" id="tags" name="{{$field.Name}}" type="text" placeholder="tags" value="{{$field.Flash}}" />
			</div>
			{{end}}
			
			{{$savedAuthor := .savedAuthor}}
			{{with $field := field "quote.Author" .}}
			<div class="form-group {{$field.ErrorClass}} col-xs-3">
				<input class="form-control" id="author" name="{{$field.Name}}" type="text" placeholder="author" value="{{$savedAuthor}}" />
			</div>
			{{end}}

			<div class="form-group col-xs-3">
				<button id="submit" name="submit" type="submit" class="btn btn-primary">submit</button>
			</div>
		</div>
	</form>

		<form class="form-inline" role="form" method="get" action="">
			<div class="form-group">
				<input class="form-control" type="search" id="search" name="search" value="{{.page.Search}}" placeholder="search" />
			</div>
		
			<div class="form-group">
			<select name="order" class="form-control">
				<option value="created">Date</option>
				<option value="rating">Rating</option>
			</select>
			</div>

			
			<button class="btn btn-primary" type=""><span class="glyphicon glyphicon-search"></span></button>
		</form>

	<div class="text-right">
		<a href="?dir=desc
			{{if .page.Search}}&search={{.page.Search}}{{end}}
			{{if .page.Page}}&page={{.page.Page}}{{end}}
			{{if .page.Size}}&size={{.page.Size}}{{end}}
			{{if .page.Tag}}&tag={{.page.Tag}}{{end}}
			{{if .page.Order}}&order={{.page.Order}}{{end}}
			
		">
			<span class="glyphicon glyphicon-chevron-up"></span>
		</a>
		<a href="?dir=asc	
			{{if .page.Search}}&search={{.page.Search}}{{end}}
			{{if .page.Page}}&page={{.page.Page}}{{end}}
			{{if .page.Size}}&size={{.page.Size}}{{end}}
			{{if .page.Tag}}&tag={{.page.Tag}}{{end}}
			{{if .page.Order}}&order={{.page.Order}}{{end}}
		">
			<span class="glyphicon glyphicon-chevron-down"></span>
		</a>
	</div>

	<div id="tagcloud">
	{{range $t := .tagcloud}}
		<a href="?tag={{$t}}">{{$t}}</a>
	{{end}}
	</div>
	<br/>


	<div id="pageLinks" class="clearfix">
		<a class="btn btn-default pull-left" {{if eq .page.HasPrev false}}disabled="disabled"{{end}} 
			href="?page={{.page.PrevPage}}
				{{if .page.Search}}&search={{.page.Search}}{{end}}
				{{if .page.Size}}&size={{.page.Size}}{{end}}
				{{if .page.Tag}}&tag={{.page.Tag}}{{end}}
				{{if .page.Order}}&order={{.page.Order}}{{end}}
				{{if .page.OrderDir}}&dir={{.page.OrderDir}}{{end}}
		">
			prev
		</a>
		<a class="btn btn-default pull-right" {{if eq .page.HasNext false}}disabled="disabled"{{end}} 
			href="?page={{.page.NextPage}}
				{{if .page.Search}}&search={{.page.Search}}{{end}}
				{{if .page.Size}}&size={{.page.Size}}{{end}}
				{{if .page.Tag}}&tag={{.page.Tag}}{{end}}
				{{if .page.Order}}&order={{.page.Order}}{{end}}
				{{if .page.OrderDir}}&dir={{.page.OrderDir}}{{end}}
		">
			next
		</a>
	</div>
	
	<br/>

	{{$page := .page}}

	<div class="clearfix quoteList">
	{{range $e := .entries}}
		<article id="q{{$e.QuoteId}}">
			<header class="container">
				<div class="col-xs-8">
					<p class="text-info">{{$e.Author}} &mdash; {{$e.Time}}</p>
				</div>

				<div class="col-xs-4 text-right">
					<a class="btn btn-danger btn-xs btn-vote" role="button" href="/downvote?id={{$e.QuoteId}}
						{{if $page.Search}}&search={{$page.Search}}{{end}}
						{{if $page.Page}}&page={{$page.Page}}{{end}}
						{{if $page.Size}}&size={{$page.Size}}{{end}}
						{{if $page.Tag}}&tag={{$page.Tag}}{{end}}
						{{if $page.Order}}&order={{$page.Order}}{{end}}
						#q{{$e.QuoteId}}
					">-</a>
					<span>{{$e.Rating}}</span>
					<a class="btn btn-success btn-xs btn-vote" role="button" href="/upvote?id={{$e.QuoteId}}
						{{if $page.Search}}&search={{$page.Search}}{{end}}
						{{if $page.Page}}&page={{$page.Page}}{{end}}
						{{if $page.Size}}&size={{$page.Size}}{{end}}
						{{if $page.Tag}}&tag={{$page.Tag}}{{end}}
						{{if $page.Order}}&order={{$page.Order}}{{end}}
						#q{{$e.QuoteId}}
					">+</a>
				</div>
			</header>
			<!-- TODO: could use a `well' class instead -->
			<a class="quote" href="/q/{{$e.QuoteId}}">
				<pre class="">{{$e.Clip}}</pre>
			</a>
			<p class="text-info">
			{{range $t := $e.Tags}}
				<a href="?tag={{$t}}">{{$t}}</a>
			{{end}}
			</p>
		</article>
	{{else}}
		<p class="text-info">No more results</p>
	{{end}}
	</div>
</div>


{{template "footer.html" .}}
